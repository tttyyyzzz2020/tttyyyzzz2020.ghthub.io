<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> typealias类型别名和associatedtype类型占位 · tttyyyzzz2020</title><meta name="description" content="typealias类型别名和associatedtype类型占位 - yongzhan"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="../../../../favicon.png"><link rel="stylesheet" href="../../../../css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://tttyyyzzz2020.ghthub.io/atom.xml" title="tttyyyzzz2020"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="atom.xml" title="tttyyyzzz2020" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="../../../../index.html" class="logo-link"><img src="../../../../favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="../../../../index.html" target="_self" class="nav-list-link">POSTS</a></li><li class="nav-list-item"><a href="../../../../archives/" target="_self" class="nav-list-link">ARCHIVES</a></li><li class="nav-list-item"><a href="../../../../atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">typealias类型别名和associatedtype类型占位</h1><div class="post-info">2020年8月30日</div><div class="post-content"><p>学习typealias和associatedtype 类型占位</p>
<h2 id="typealias-类型别名"><a href="#typealias-类型别名" class="headerlink" title="typealias 类型别名"></a>typealias 类型别名</h2><blockquote>
<p>typealias 用来给已经存在的类型从新定义名字</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Location</span> = <span class="type">CGPoint</span>    <span class="comment">//如将CGPint 取别名Location</span></span><br></pre></td></tr></table></figure>

<h4 id="使用-typealias-更好的阅读性"><a href="#使用-typealias-更好的阅读性" class="headerlink" title="使用 typealias 更好的阅读性"></a>使用 typealias 更好的阅读性</h4><blockquote>
<p>原代码，两点差值距离</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">distance</span><span class="params">(from point: CGPoint, to anotherPoint: CGPoint)</span></span> -&gt; <span class="type">Double</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> dx = <span class="type">Double</span>(anotherPoint.x - point.x)</span><br><span class="line">    <span class="keyword">let</span> dy = <span class="type">Double</span>(anotherPoint.y - point.y)</span><br><span class="line">    <span class="keyword">return</span> sqrt(dx * dx + dy * dy)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> origin: <span class="type">CGPoint</span> = <span class="type">CGPoint</span>(x: <span class="number">0</span>, y: <span class="number">0</span>)</span><br><span class="line"><span class="keyword">let</span> point: <span class="type">CGPoint</span> = <span class="type">CGPoint</span>(x: <span class="number">1</span>, y: <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> d: <span class="type">Double</span> =  <span class="built_in">distance</span>(from: origin, to: point)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>取别名后，有了更好的阅读性</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">Location</span> = <span class="type">CGPoint</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">Distance</span> = <span class="type">Double</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">distance</span><span class="params">(from location: Location,</span></span></span><br><span class="line"><span class="function"><span class="params">    to anotherLocation: Location)</span></span> -&gt; <span class="type">Distance</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> dx = <span class="type">Distance</span>(location.x - anotherLocation.x)</span><br><span class="line">        <span class="keyword">let</span> dy = <span class="type">Distance</span>(location.y - anotherLocation.y)</span><br><span class="line">        <span class="keyword">return</span> sqrt(dx * dx + dy * dy)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> origin: <span class="type">Location</span> = <span class="type">Location</span>(x: <span class="number">0</span>, y: <span class="number">0</span>)</span><br><span class="line"><span class="keyword">let</span> point: <span class="type">Location</span> = <span class="type">Location</span>(x: <span class="number">1</span>, y: <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> d: <span class="type">Distance</span> = <span class="built_in">distance</span>(from: origin, to: point)</span><br></pre></td></tr></table></figure>

<h3 id="在typealias-别名中引入泛型"><a href="#在typealias-别名中引入泛型" class="headerlink" title="在typealias 别名中引入泛型"></a>在typealias 别名中引入泛型</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>&lt;<span class="title">T</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">Worker</span>&lt;<span class="type">T</span>&gt; = <span class="type">Person</span>&lt;<span class="type">T</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="使用别名遵循多个协议"><a href="#使用别名遵循多个协议" class="headerlink" title="使用别名遵循多个协议"></a>使用别名遵循多个协议</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Cat</span> </span>&#123; ... &#125;</span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Dog</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">Pat</span> = <span class="type">Cat</span> &amp; <span class="type">Dog</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>不知codeable 有类同用法，记得不太清楚。。。</p>
</blockquote>
<h2 id="associatedtype-类型占位"><a href="#associatedtype-类型占位" class="headerlink" title="associatedtype 类型占位"></a>associatedtype 类型占位</h2><blockquote>
<p>目标使得Tiger类只能吃Meat类食物</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Food</span></span>&#123; &#125;</span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Animal</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Meat</span>:<span class="title">Food</span> </span>&#123; &#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Grass</span>: <span class="title">Food</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Tiger</span>: <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">eat</span><span class="params">( <span class="number">_</span> food: Food)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> meta = food <span class="keyword">as</span>? meat &#123;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"eat \(food)"</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">fatalError</span>(<span class="string">"Tiger can only eat meat!"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处使用了as?转义Food类显得多余，更好的处理是给Animal定义一个类型占位， 代码如下</p>
<h3 id="使用-associatedtype-预先占位类型，配合typealias动态分配类型"><a href="#使用-associatedtype-预先占位类型，配合typealias动态分配类型" class="headerlink" title="使用 associatedtype 预先占位类型，配合typealias动态分配类型"></a>使用 associatedtype 预先占位类型，配合typealias动态分配类型</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Food</span></span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Meat</span>:<span class="title">Food</span> </span>&#123; &#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Grass</span>: <span class="title">Food</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">associatedtype</span> <span class="type">F</span>: <span class="type">Food</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">eat</span><span class="params">(<span class="number">_</span> food: F )</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Tiger</span>: <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">typealias</span> <span class="type">F</span> = <span class="type">Meat</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">eat</span><span class="params">(<span class="number">_</span> food: Meat)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"eat \(food)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Sheep</span>: <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">eat</span><span class="params">(<span class="number">_</span> food: Grass)</span></span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"eat \(food)"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>associatedtype 预先定义了一个类型占位，子类可以在自身再从新分配想要的类型，比如给老虎定义了Meat类， 我们不再需要那多余的转义了。</p>
</blockquote>
<blockquote>
</blockquote>
<h3 id="使用associatedtype-后注意事项⚠️"><a href="#使用associatedtype-后注意事项⚠️" class="headerlink" title="使用associatedtype 后注意事项⚠️"></a>使用associatedtype 后注意事项⚠️</h3><blockquote>
<p>使用associatedtype 后Animal协议将不能独立使用了。因为他有一个不确定的类型，所以如下代码将不能通过编译。</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isDangerous</span><span class="params">(animal: Animal)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> animal <span class="keyword">is</span> <span class="type">Tiger</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上方无法编译</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要改写车给泛型约束，（这块还不是太懂，强行理解😂）</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isDangerous</span>&lt;T: Animal&gt;<span class="params">(animal: T)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> animal <span class="keyword">is</span> <span class="type">Tiger</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">isDangerous(animal: <span class="type">Tiger</span>()) <span class="comment">// true</span></span><br><span class="line">isDangerous(animal: <span class="type">Sheep</span>()) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

</div></article></div></main><footer><div class="paginator"><a href="../../19/SwiftUI-StateManager/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2020 <a href="http://tttyyyzzz2020.ghthub.io">yongzhan</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>