<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 使用@PropertyWrapper创建自定义属性包装器 · tttyyyzzz2020</title><meta name="description" content="使用@PropertyWrapper创建自定义属性包装器 - yongzhan"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://tttyyyzzz2020.ghthub.io/atom.xml" title="tttyyyzzz2020"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="tttyyyzzz2020" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">POSTS</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVES</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">使用@PropertyWrapper创建自定义属性包装器</h1><div class="post-info">2020年3月14日</div><div class="post-content"><h2 id="PropertyWrapper的简述"><a href="#PropertyWrapper的简述" class="headerlink" title="@PropertyWrapper的简述"></a>@PropertyWrapper的简述</h2><blockquote>
<p><code>@PropertyWrapper</code>的主要作用，是可以对在原始的属性变量，添加一个分离层，使得对属性的获取和设置更细微自由， 从而移除一些重复或类似的代码。</p>
</blockquote>
<p> 在swiftUI中，已经有很多定义好的包装器了。</p>
 <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> @<span class="type">State</span>.</span><br><span class="line"> <span class="comment">//可以将属性绑定到view视图，实现与界面实时响应</span></span><br><span class="line"> @<span class="type">Binding</span>.</span><br><span class="line"><span class="comment">//可以将父级的属性通过$传输绑定到子级</span></span><br><span class="line"> @<span class="type">ObservedObject</span>.</span><br><span class="line"><span class="comment">//和@State类同，但它绑定的值是需要继承自ObservableObject协议，且必须为类的方式实现，其中@Publisehd 修饰的属性将会与view视图同步响应</span></span><br><span class="line"> @<span class="type">Published</span>.</span><br><span class="line"><span class="comment">//定义在ObservableObject的类中，它包装的属性，在值变化的时候就会调用objectWillChange方法发出通知</span></span><br><span class="line"> @<span class="type">EnvironmentObject</span>.</span><br><span class="line"><span class="comment">//与 @ObservedObject相似，但它可以使得多个视图之间共享数据，而无需通过属性逐级传递</span></span><br><span class="line"> @<span class="type">Environment</span>.</span><br><span class="line"><span class="comment">//可以注入系统本省的环紧信息，如设备信息，主题色，布局，视图尺寸</span></span><br></pre></td></tr></table></figure>


<p>除了使用系统提供的包转器，我们也可以自行定义属性包装器。</p>
<h2 id="自定义一个属性包装器"><a href="#自定义一个属性包装器" class="headerlink" title="自定义一个属性包装器"></a>自定义一个属性包装器</h2><p> 主要的步骤如下</p>
<p> 1.用<code>@propertyWrapper</code>修饰一个<code>struct,class</code>或<code>enum</code><br> 2.定义一个<code>wrappedValue</code>属性并实现它的<code>getter</code>和<code>setter</code>方法，完成我们想要的逻辑<br> 3.还可以自行定义一个初始化方法，来对<code>wrappedValue</code>进行初始化设置<br> 4.也可以创建一个可选的<code>projectedValue</code>属性映射， 如果要获取它关联的值需要使用$符号<br> 5.使用属性包装的语法是加上<code>@</code>符号接上包装器名称</p>
<h4 id="栗子1-转大写的包装器-Uppercased"><a href="#栗子1-转大写的包装器-Uppercased" class="headerlink" title="栗子1: 转大写的包装器@Uppercased"></a>栗子1: 转大写的包装器<code>@Uppercased</code></h4><blockquote>
<p>创建一个<code>@Uppercased</code>的包装器， 功能是将存的值转为大写</p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@propertyWrapper</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Uppercased</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> text: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> wrappedValue: <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; text.uppercased() &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123; text = newValue &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">init</span>(wrappedValue: <span class="type">String</span>)  &#123;</span><br><span class="line">        <span class="keyword">self</span>.text = wrappedValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    @<span class="type">Uppercased</span> <span class="keyword">var</span> username: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = <span class="type">User</span>(username: <span class="string">"alfianlo"</span>)</span><br><span class="line"><span class="built_in">print</span>(user.username) <span class="comment">// ALFIANLO</span></span><br></pre></td></tr></table></figure>
<p>代码说明：</p>
<blockquote>
<ol>
<li>在<code>@Uppercased</code>包装器中真正存值的是<code>text</code>属性</li>
<li>而我们访问和操作的都是<code>wrappedValue</code>， 在获取时候会将<code>text</code>的值转大写后返回</li>
<li>在包装器初始化时候我们会设置text的值</li>
<li>在User中使用<code>@Uppercased</code>包装了<code>username</code>,所以<code>username</code>的值在获取时候就会转为大写</li>
</ol>
</blockquote>
<h4 id="栗子2-限定数值大小的包装器-Ranged"><a href="#栗子2-限定数值大小的包装器-Ranged" class="headerlink" title="栗子2: 限定数值大小的包装器@Ranged"></a>栗子2: 限定数值大小的包装器<code>@Ranged</code></h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@propertyWrapper</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ranged</span>&lt;<span class="title">T</span>: <span class="title">Comparable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> minimum: <span class="type">T</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> maximum: <span class="type">T</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> value: <span class="type">T</span></span><br><span class="line">    <span class="keyword">var</span> wrappedValue: <span class="type">T</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; value &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> newValue &gt; maximum &#123;</span><br><span class="line">                value = maximum</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> newValue &lt; minimum &#123;</span><br><span class="line">                value = minimum</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                value = newValue</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">init</span>(wrappedValue: <span class="type">T</span>, minimum: <span class="type">T</span>, maximum: <span class="type">T</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.minimum = minimum</span><br><span class="line">        <span class="keyword">self</span>.maximum = maximum</span><br><span class="line">        <span class="keyword">self</span>.value = wrappedValue</span><br><span class="line">        <span class="keyword">self</span>.wrappedValue = wrappedValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Form</span> </span>&#123;</span><br><span class="line">    @<span class="type">Ranged</span>(minimum: <span class="number">17</span>, maximum: <span class="number">65</span>) <span class="keyword">var</span> age: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> form = <span class="type">Form</span>()</span><br><span class="line">form.age = <span class="number">100</span> <span class="comment">// 65</span></span><br><span class="line">form.age = <span class="number">2</span> <span class="comment">// 17</span></span><br></pre></td></tr></table></figure>
<p>代码说明：</p>
<blockquote>
<p>1.<code>@Ranged</code>包装器的功能是限定属性取值的最大和最小值。<br>2.包装器的<code>init</code>方法接收了2个参数，这样在使用时就可以灵活控制取值的范围。</p>
</blockquote>
<h4 id="栗子3-包装器值的映射"><a href="#栗子3-包装器值的映射" class="headerlink" title="栗子3: 包装器值的映射"></a>栗子3: 包装器值的映射</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@propertyWrapper</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ISO8601DateFormatted</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">let</span> formatter = <span class="type">ISO8601DateFormatter</span>()</span><br><span class="line">    <span class="keyword">var</span> projectedValue: <span class="type">String</span> &#123; <span class="type">ISO8601DateFormatted</span>.formatter.string(from: wrappedValue) &#125;</span><br><span class="line">    <span class="keyword">var</span> wrappedValue: <span class="type">Date</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Form</span> </span>&#123;</span><br><span class="line">    @<span class="type">ISO8601DateFormatted</span> <span class="keyword">var</span> lastLoginAt: <span class="type">Date</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> user = <span class="type">Form</span>(lastLoginAt: <span class="type">Date</span>())</span><br><span class="line"><span class="built_in">print</span>(user.$lastLoginAt) <span class="comment">// "2020-07-11T10:54:42Z"</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面的的包装器中我们添加加的<code>projectedValue</code>作为映射, 当需要访问<code>wrappedValue</code>可以通过<code>$</code>加上属性名的方式访问处理后的值， 在这个的栗子我们在读取<code>warppedValue</code>存储的日期时后，都会经过<code>ISO8601DateFormatter</code>的格式化处理</p>
</blockquote>
<h4 id="栗子4-本地存储包装器-UserDefault"><a href="#栗子4-本地存储包装器-UserDefault" class="headerlink" title="栗子4: 本地存储包装器@UserDefault"></a>栗子4: 本地存储包装器<code>@UserDefault</code></h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@propertyWrapper</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">UserDefault</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> key: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> initialValue: <span class="type">T</span></span><br><span class="line">    <span class="keyword">var</span> wrappedValue: <span class="type">T</span> &#123;</span><br><span class="line">        <span class="keyword">set</span> &#123; <span class="type">UserDefaults</span>.standard.<span class="keyword">set</span>(newValue, forKey: key) &#125;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="type">UserDefaults</span>.standard.object(forKey: key) <span class="keyword">as</span>? <span class="type">T</span> ?? initialValue &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">UserPreferences</span> </span>&#123;</span><br><span class="line">    @<span class="type">UserDefault</span>(key: <span class="string">"isCheatModeEnabled"</span>, initialValue: <span class="literal">false</span>) <span class="keyword">static</span> <span class="keyword">var</span> isCheatModeEnabled: <span class="type">Bool</span></span><br><span class="line">    @<span class="type">UserDefault</span>(key: <span class="string">"highestScore"</span>, initialValue: <span class="number">10000</span>) <span class="keyword">static</span> <span class="keyword">var</span> highestScore: <span class="type">Int</span></span><br><span class="line">    @<span class="type">UserDefault</span>(key: <span class="string">"nickname"</span>, initialValue: <span class="string">"cloudstrife97"</span>) <span class="keyword">static</span> <span class="keyword">var</span> nickname: <span class="type">String</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">UserPreferences</span>.isCheatModeEnabled = <span class="literal">true</span></span><br><span class="line"><span class="type">UserPreferences</span>.highestScore = <span class="number">25000</span></span><br><span class="line"><span class="type">UserPreferences</span>.nickname = <span class="string">"squallleonhart"</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>最后这个栗子， 是一个使用属性包装器简化不同类型数据本地存储的代码。使用<code>@UserDefault</code>修饰过的属性，在获取和设置时都会同步保存在本地存储中。</p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/2020/04/10/SwiftUI-custome-modifier/" class="prev">上一篇</a><a href="/2020/02/12/SwiftUI-autoclosures/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2020 <a href="http://tttyyyzzz2020.ghthub.io">yongzhan</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>